/*! markdown-it-wrap-alphabet 1.1.1 https://github.com/Alexs7zzh/markdown-it-wrap-alphabet @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).markdownitIns=e()}(this,(function(){"use strict";function t(t,e,n){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}t.prototype.attrIndex=function(t){var e,n,i;if(!this.attrs)return-1;for(n=0,i=(e=this.attrs).length;n<i;n++)if(e[n][0]===t)return n;return-1},t.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]},t.prototype.attrSet=function(t,e){var n=this.attrIndex(t),i=[t,e];n<0?this.attrPush(i):this.attrs[n]=i},t.prototype.attrGet=function(t){var e=this.attrIndex(t),n=null;return e>=0&&(n=this.attrs[e][1]),n},t.prototype.attrJoin=function(t,e){var n=this.attrIndex(t);n<0?this.attrPush([t,e]):this.attrs[n][1]=this.attrs[n][1]+" "+e};var e=t;const n="《》「」『』（）”“、。，？！；：",i=t=>t&&"text"===t.type&&t.meta&&t.meta.isEn,s=t=>t&&"text"===t.type&&t.meta&&!t.meta.isEn,o=t=>[...t.matchAll(/([\w,.;'"’‘”“ ()\-–—…+!?&/<>*[\]:@#=]+)/g)].filter((t=>/[a-zA-Z]/.test(t[0]))),r=t=>/\p{Unified_Ideograph}/u.test(t),l=t=>{const e=o(t);let n=[];return 0===e.length?(n.push({text:t,isEn:!1}),n):(0!==e[0].index&&n.push({text:t.slice(0,e[0].index),isEn:!1}),e.forEach(((i,s)=>{n.push({text:i[0],isEn:!0}),s+1<e.length?n.push({text:t.slice(i.index+i[0].length,e[s+1].index),isEn:!1}):i.index+i[0].length!=t.length&&n.push({text:t.slice(i.index+i[0].length),isEn:!1})})),n)},c=(t,e,n,i)=>[].concat(t.slice(0,e),i,t.slice(n));return(t,a)=>{a=Object.assign({},{before:"before",after:"after",lang:"",wrapAll:!1},a);const h=(t=!1,n=!1)=>{let i=new e("en_open","span",1);return t&&i.attrJoin("class",a.before),n&&i.attrJoin("class",a.after),""!==a.lang&&i.attrPush(["lang",a.lang]),i};t.core.ruler.push("wrapEnglish",(t=>{if(!r(t.src))return!1;for(let d=t.tokens.length-1;d>=0;d--){if("inline"!==t.tokens[d].type)continue;if(g=t.tokens[d].content,0===o(g).length)continue;if(!a.wrapAll&&!r(t.tokens[d].content))continue;let x=t.tokens[d].children;for(let n=x.length-1;n>=0;n--){if("text"!==x[n].type)continue;if(!x[n].content||""===x[n].content)continue;let i=l(x[n].content);i=i.map((t=>{let n=new e("text","",0);return n.content=t.text,n.meta={isEn:t.isEn},n})),t.tokens[d].children=(f=n,u=i,x=[].concat((p=x).slice(0,f),u,p.slice(f+1)))}if(0===x.length)continue;let y=0,m=-1;const E=["en_close","footnote_ref","hardbreak"];for(let o=0;o<x.length;o++){if(y+=x[o].nesting,s(x[o])&&(m=o),!i(x[o]))continue;let r=o,l=o,a=y,p=y,f=[];for(;r>=0&&!E.includes(x[r].type)&&!s(x[r])&&-1!==x[l].nesting;)1===x[r].nesting&&f.push(x[r].type.replace("_open","")),a-=x[r--].nesting;for(;l<x.length&&!E.includes(x[l].type)&&!s(x[l]);){if(1===x[l].nesting&&f.push(x[l].type.replace("_open","")),-1===x[l].nesting){if(!f.includes(x[l].type.replace("_close","")))break;{const t=f.indexOf(x[l].type.replace("_close",""));f.splice(t,1)}}p+=x[l++].nesting}if(r++,a!==p)if(Math.abs(a-y)>Math.abs(p-y))for(;a!==p&&r<x.length;)a+=x[r++].nesting;else{for(l===x.length&&l--;(a!==p||0!==f.length)&&l>=0;){if(p-=x[l].nesting,1===x[l].nesting){const t=f.indexOf(x[l].type.replace("_open",""));f.splice(t,1)}-1===x[l].nesting&&f.push(x[l].type.replace("_close","")),l--}l++}let u,g=!1,b=!1;if((!x[r-1]||!E.includes(x[r-1].type))&&s(x[m])){for(u=r;u<l&&x[u]&&"text"!==x[u].type;)u++;if(x[u]&&(x[u].content=x[u].content.trimStart()),x[m]){x[m].content=x[m].content.trimEnd();const t=x[m].content;n.includes(t[t.length-1])||(g=!0)}}for(u=l;u<x.length&&x[u]&&"text"!==x[u].type;)u++;if(x[u]&&s(x[u])){x[u].content=x[u].content.trimStart();const t=x[u].content;for(n.includes(t[0])||(b=!0),u=l-1;u>=r&&x[u]&&"text"!==x[u].type;)u--;x[u]&&(x[u].content=x[u].content.trimEnd())}t.tokens[d].children=x=c(x,r,l,[h(g,b),...x.slice(r,l),new e("en_close","span",-1)]),m=o,o+=l-r,o<x.length&&(y=p)}}var p,f,u,g}))}}));
