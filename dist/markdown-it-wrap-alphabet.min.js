/*! markdown-it-wrap-alphabet 1.1.0 https://github.com/Alexs7zzh/markdown-it-wrap-alphabet @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).markdownitIns=e()}(this,(function(){"use strict";function t(t,e,n){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}t.prototype.attrIndex=function(t){var e,n,s;if(!this.attrs)return-1;for(n=0,s=(e=this.attrs).length;n<s;n++)if(e[n][0]===t)return n;return-1},t.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]},t.prototype.attrSet=function(t,e){var n=this.attrIndex(t),s=[t,e];n<0?this.attrPush(s):this.attrs[n]=s},t.prototype.attrGet=function(t){var e=this.attrIndex(t),n=null;return e>=0&&(n=this.attrs[e][1]),n},t.prototype.attrJoin=function(t,e){var n=this.attrIndex(t);n<0?this.attrPush([t,e]):this.attrs[n][1]=this.attrs[n][1]+" "+e};var e=t;const n="《》「」『』（）”“、。，？！；：",s=t=>t&&"text"===t.type&&t.meta&&t.meta.isEn,i=t=>t&&"text"===t.type&&t.meta&&!t.meta.isEn,r=(t=!1,n=!1)=>{let s=new e("en_open","span",1);return s.meta={before:t,after:n},s},o=t=>[...t.matchAll(/([\w,.;'"’‘”“ ()\-–—…+!?&/<>*[\]:@#=]+)/g)].filter((t=>/[a-zA-Z]/.test(t[0]))),l=t=>{const e=o(t);return/\p{Unified_Ideograph}/u.test(t)&&0!==e.length},c=t=>{const e=o(t);let n=[];return 0===e.length?(n.push({text:t,isEn:!1}),n):(0!==e[0].index&&n.push({text:t.slice(0,e[0].index),isEn:!1}),e.forEach(((s,i)=>{n.push({text:s[0],isEn:!0}),i+1<e.length?n.push({text:t.slice(s.index+s[0].length,e[i+1].index),isEn:!1}):s.index+s[0].length!=t.length&&n.push({text:t.slice(s.index+s[0].length),isEn:!1})})),n)},a=(t,e,n,s)=>[].concat(t.slice(0,e),s,t.slice(n)),h=t=>{for(let f=t.tokens.length-1;f>=0;f--){if("inline"!==t.tokens[f].type)continue;if(!l(t.tokens[f].content))continue;let u=t.tokens[f].children;for(let n=u.length-1;n>=0;n--){if("text"!==u[n].type)continue;if(!u[n].content||""===u[n].content)continue;let s=c(u[n].content);s=s.map((t=>{let n=new e("text","",0);return n.content=t.text,n.meta={isEn:t.isEn},n})),t.tokens[f].children=(h=n,p=s,u=[].concat((o=u).slice(0,h),p,o.slice(h+1)))}if(0===u.length)continue;let d=0,g=-1;const x=["en_close","footnote_ref","hardbreak"];for(let o=0;o<u.length;o++){if(d+=u[o].nesting,i(u[o])&&(g=o),!s(u[o]))continue;let l=o,c=o,h=d,p=d,y=[];for(;l>=0&&!x.includes(u[l].type)&&!i(u[l])&&-1!==u[c].nesting;)1===u[l].nesting&&y.push(u[l].type.replace("_open","")),h-=u[l--].nesting;for(;c<u.length&&!x.includes(u[c].type)&&!i(u[c]);){if(1===u[c].nesting&&y.push(u[c].type.replace("_open","")),-1===u[c].nesting){if(!y.includes(u[c].type.replace("_close","")))break;{const t=y.indexOf(u[c].type.replace("_close",""));y.splice(t,1)}}p+=u[c++].nesting}if(l++,h!==p)if(Math.abs(h-d)>Math.abs(p-d))for(;h!==p&&l<u.length;)h+=u[l++].nesting;else{for(c===u.length&&c--;(h!==p||0!==y.length)&&c>=0;){if(p-=u[c].nesting,1===u[c].nesting){const t=y.indexOf(u[c].type.replace("_open",""));y.splice(t,1)}-1===u[c].nesting&&y.push(u[c].type.replace("_close","")),c--}c++}let m,b=!1,E=!1;if((!u[l-1]||!x.includes(u[l-1].type))&&i(u[g])){for(m=l;m<c&&u[m]&&"text"!==u[m].type;)m++;if(u[m]&&(u[m].content=u[m].content.trimStart()),u[g]){u[g].content=u[g].content.trimEnd();const t=u[g].content;n.includes(t[t.length-1])||(b=!0)}}for(m=c;m<u.length&&u[m]&&"text"!==u[m].type;)m++;if(u[m]&&i(u[m])){u[m].content=u[m].content.trimStart();const t=u[m].content;for(n.includes(t[0])||(E=!0),m=c-1;m>=l&&u[m]&&"text"!==u[m].type;)m--;u[m]&&(u[m].content=u[m].content.trimEnd())}t.tokens[f].children=u=a(u,l,c,[r(b,E),...u.slice(l,c),new e("en_close","span",-1)]),g=o,o+=c-l,o<u.length&&(d=p)}}var o,h,p};return(t,e)=>{e=Object.assign({},{before:"before",after:"after",lang:""},e);t.renderer.rules.en_open=(t,n)=>{const s=t[n].meta;let i=[];return s.before&&i.push(e.before),s.after&&i.push(e.after),`<span ${""===e.lang?"":`lang='${e.lang}' `}class='${i.join(" ")}'>`},t.renderer.rules.en_close=()=>"</span>",t.core.ruler.push("wrapEnglish",h)}}));
