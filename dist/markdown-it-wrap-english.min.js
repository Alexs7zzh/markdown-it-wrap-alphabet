/*! markdown-it-wrapping 1.0.0 https://github.com/ @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).markdownitIns=e()}(this,(function(){"use strict";function t(t,e,n){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}t.prototype.attrIndex=function(t){var e,n,s;if(!this.attrs)return-1;for(n=0,s=(e=this.attrs).length;n<s;n++)if(e[n][0]===t)return n;return-1},t.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]},t.prototype.attrSet=function(t,e){var n=this.attrIndex(t),s=[t,e];n<0?this.attrPush(s):this.attrs[n]=s},t.prototype.attrGet=function(t){var e=this.attrIndex(t),n=null;return e>=0&&(n=this.attrs[e][1]),n},t.prototype.attrJoin=function(t,e){var n=this.attrIndex(t);n<0?this.attrPush([t,e]):this.attrs[n][1]=this.attrs[n][1]+" "+e};var e=t;const n="《》「」『』（）”“、。，？！；：",s=t=>t&&"text"===t.type&&t.meta&&t.meta.isEn,i=t=>t&&"text"===t.type&&t.meta&&!t.meta.isEn,r=(t=!1,n=!1)=>{let s=new e("en_open","span",1);return s.meta={before:t,after:n},s},o=(t,e)=>{const n=t[e].meta;let s=[];return n.before&&s.push("before"),n.after&&s.push("after"),`<span class='${s.join(" ")}'>`},l=()=>"</span>",c=t=>[...t.matchAll(/([\w,.;'"’‘”“ ()\-–—…+!?&/<>*[\]:@#=]+)/g)].filter((t=>/[a-zA-Z]/.test(t[0]))),h=t=>{const e=c(t);return/\p{Unified_Ideograph}/u.test(t)&&0!==e.length},a=t=>{const e=c(t);let n=[];return 0===e.length?(n.push({text:t,isEn:!1}),n):(0!==e[0].index&&n.push({text:t.slice(0,e[0].index),isEn:!1}),e.forEach(((s,i)=>{n.push({text:s[0],isEn:!0}),i+1<e.length?n.push({text:t.slice(s.index+s[0].length,e[i+1].index),isEn:!1}):s.index+s[0].length!=t.length&&n.push({text:t.slice(s.index+s[0].length),isEn:!1})})),n)},p=(t,e,n,s)=>[].concat(t.slice(0,e),s,t.slice(n)),u=t=>{for(let u=t.tokens.length-1;u>=0;u--){if("inline"!==t.tokens[u].type)continue;if(!h(t.tokens[u].content))continue;let f=t.tokens[u].children;for(let n=f.length-1;n>=0;n--){if("text"!==f[n].type)continue;if(!f[n].content||""===f[n].content)continue;let s=a(f[n].content);s=s.map((t=>{let n=new e("text","",0);return n.content=t.text,n.meta={isEn:t.isEn},n})),t.tokens[u].children=(l=n,c=s,f=[].concat((o=f).slice(0,l),c,o.slice(l+1)))}if(0===f.length)continue;let d=0,g=-1;const x=["en_close","footnote_ref","hardbreak"];for(let o=0;o<f.length;o++){if(d+=f[o].nesting,i(f[o])&&(g=o),!s(f[o]))continue;let l=o,c=o,h=d,a=d,y=[];for(;l>=0&&!x.includes(f[l].type)&&!i(f[l])&&-1!==f[c].nesting;)1===f[l].nesting&&y.push(f[l].type.replace("_open","")),h-=f[l--].nesting;for(;c<f.length&&!x.includes(f[c].type)&&!i(f[c]);){if(1===f[c].nesting&&y.push(f[c].type.replace("_open","")),-1===f[c].nesting){if(!y.includes(f[c].type.replace("_close","")))break;{const t=y.indexOf(f[c].type.replace("_close",""));y.splice(t,1)}}a+=f[c++].nesting}if(l++,h!==a)if(Math.abs(h-d)>Math.abs(a-d))for(;h!==a&&l<f.length;)h+=f[l++].nesting;else{for(c===f.length&&c--;(h!==a||0!==y.length)&&c>=0;){if(a-=f[c].nesting,1===f[c].nesting){const t=y.indexOf(f[c].type.replace("_open",""));y.splice(t,1)}-1===f[c].nesting&&y.push(f[c].type.replace("_close","")),c--}c++}let m,E=!1,_=!1;if((!f[l-1]||!x.includes(f[l-1].type))&&i(f[g])){for(m=l;m<c&&f[m]&&"text"!==f[m].type;)m++;if(f[m]&&(f[m].content=f[m].content.trimStart()),f[g]){f[g].content=f[g].content.trimEnd();const t=f[g].content;n.includes(t[t.length-1])||(E=!0)}}for(m=c;m<f.length&&f[m]&&"text"!==f[m].type;)m++;if(f[m]&&i(f[m])){f[m].content=f[m].content.trimStart();const t=f[m].content;for(n.includes(t[0])||(_=!0),m=c-1;m>=l&&f[m]&&"text"!==f[m].type;)m--;f[m]&&(f[m].content=f[m].content.trimEnd())}t.tokens[u].children=f=p(f,l,c,[r(E,_),...f.slice(l,c),new e("en_close","span",-1)]),g=o,o+=c-l,o<f.length&&(d=a)}}var o,l,c};return t=>{t.renderer.rules.en_open=o,t.renderer.rules.en_close=l,t.core.ruler.push("wrapEnglish",u)}}));
